---
title: "Dealing with .dta"
output: github_document
---
## Loading packages
The first step for moving from STATA to R is getting access to your .dta files. There are multiple packages that can read and write .dta files, were going to use `haven`.

Haven is not part of base-R, so it has to be installed if you haven't done so before. One a package has been installed on a system, however, you don't need to reinstall it. You should already know now to install packages, from the previous chapter. With have in stalled, put `library(haven)` at the top of you R script. R scripts (as with scripts in all programming languages) with the first line and goes through the program. As long as `library(haven)` appears in you file before you attept to use it, you should be fine. That being said, the convention is to put all packages used at the beginning of your script, with each being on a new line (ex: *figure 1*).

*figure 1*
```{r, fig.cap='figure 1', message=FALSE}
library(dplyr)
library(ggplot2)
library(haven)
```

## Using haven to import STATA files
Below the packages that you'll be using, you then need to import your data. This is done with the command `read_dta()`. As you probably want to actually load the data into the environment, and not just print the observations in the colsole, you'll have to assign the data a name. In R, names can contain uppercase and lowercase letter, numbers, underscores, and periods. An object name cannot, contain spaces, begin with a number, or contain symbols such as $ or %. Also, names cannot be the same as a function in base-R or any of the packages you are using.

```
my.data <- read_dta('data.dta') # this works
MyDaTa <- read_dta('data.dta') # so does this

sum <- read_dta('data.dta') # this doesn't, sum() is a function in base-R

data2 <- read_dta('data.dat') # this is fine
2data <- read_dta('data.dat') # this isn't
```

Names are assigned by using `<-`, typically with a space before and after (though this isn't necessary, it keeps the code clean and easy to read). To load your data, give it a name (that conforms with R's rules) followed by `<-` and then `read_dta()`. If your data is in your working directory, you can simply write the file name inside either single ('') or double ("") quotes. To find you working directory, type `getwd()` into the console. 

If your file is in a subdirectory of your workind directory, you can simple speficy the subdirectiory. For example, if you keep all of your datasets in a folder 'data', you would type `read_dta('data/data.dta')`. If you data is outside of your working directory, you can specify the complete file path. for example `read_dta('~/home/user/Desktop/datasets/data.dta')`. 

## Dealing with errors
The `read_dta()` function supports STATA versions 8-15. If you import your file and it doesn't look right, there may be an issue with interpreting the version. This can be fixed by adding a comma after the file name, followed by `version = ` and then the version of STATA that wrote the file For example, importing a file from STATA 10 would look like this:
```
stata.data <- read_dta('data/data.dta', version = 10)
```
If there's still an issue, it might be the econding. Before STATA 14, files just relied on the default decosing of the system when writing a file. This means that a file written on Windows may not have the same encoding as one written on Mac or Linux. If you get the meggage `"Unable to convert string to the requested encoding"`, it's probably because STATA saved the default Windows encoding, windows-1252. To fix this, add `encoding = "latin1"` after the version (again seperated with a comma). 
```
stata.data <- read_dta('data/data.dta', version = 10, encoding = "latin1")
```

Of course, if you saved the file on you own computer or the file was save using STATA 14 or newer. This shouldn't be a problem. 

## But there's still problems
If you're still having errors at this point, the best option is probable to quit. Unistall R, throw your laptop into the sea, fish it our because you're worried about pollution, chuck it in rice because you realize that you started learning R to save money.

Or, start practicing th single most important programming skill there is: looking up the answer on the internet.
When something doesn't run, R prints and error message 